@using System.Security.Claims;

@model User

@{
  ViewData["Title"] = Model.UserName;

  string? userId = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
  bool isFollowed = ViewData["IsFollowed"] as bool? ?? false;
  var followers = ViewData["Followers"] as IEnumerable<User> ?? Enumerable.Empty<User>();
  var followedUsers = ViewData["FollowedUsers"] as IEnumerable<User> ?? Enumerable.Empty<User>();
  string? FollowedUserId = @Model.Id;
}

<h1>@ViewData["Title"]</h1>

<style>
  .img-account-profile {
    height: 10rem;
  }

  .rounded-circle {
    border-radius: 50% !important;
  }

  .card {
    box-shadow: 0 0.15rem 1.75rem 0 rgb(33 40 50 / 15%);
  }

  .card .card-header {
    font-weight: 500;
  }

  .card-header:first-child {
    border-radius: 0.35rem 0.35rem 0 0;
  }

  .card-header {
    padding: 1rem 1.35rem;
    margin-bottom: 0;
    background-color: rgba(33, 40, 50, 0.03);
    border-bottom: 1px solid rgba(33, 40, 50, 0.125);
  }
  
    .modal-header,
    .modal-footer {
        background-color: #2d3238;
    }

    .modal-body {
        background-color: #2d3238;
    }
</style>

<div class="container-xl px-4 mt-4">
  <hr class="mt-0 mb-4">
  <div class="row">
    <div class="col-xl-4">
      <div class="card mb-4 mb-xl-0 bg-dark">
        <div class="card-header">Profile Picture</div>
        <div class="card-body text-center">
          @if (string.IsNullOrWhiteSpace(Model.ProfilePicture))
          {
            <img class="img-account-profile rounded-circle mb-2" src="~/ProfilePictures/DefaultProfilePicture.png" alt="">
          }
          else
          {
            <img class="img-account-profile rounded-circle mb-2" src="@Model.ProfilePicture" alt="">
          }
        </div>
        @if (!isFollowed && Model.Id != userId) {
          <form class="text-center mb-3" method="post" asp-action="Follow" asp-controller="User">
            <input type="hidden" asp-for="@FollowedUserId">
            <button class="btn btn-warning" type="Submit">Follow</button>
          </form>
        }
        else if (Model.Id == userId) {
          <form class="text-center mb-3" >
            <a class="btn btn-warning" asp-area="" asp-controller="User" asp-action="UpdateProfile">Edit Profile</a>
          </form>
        }
      </div>
    </div>
    <div class="col-xl-8">
      <div class="card mb-4 bg-dark">
        <div class="card-header">Account Details</div>
        <div class="card-body"><div class="mb-3">
              <label class="small mb-1" for="inputUsername">Username</label>
              <input class="form-control" id="inputUsername" type="text"
                placeholder="Enter your username" value="@Model.UserName" readonly>
            </div>
            @if(Model.Id == userId) {
              <div class="mb-3">
                <label class="small mb-1" for="inputEmailAddress">Email address</label>
                <input class="form-control" id="inputEmailAddress" type="email"
                  placeholder="Enter your email address" value="@Model.Email" readonly>
              </div>
              <div class="mb-3">
                <label class="small mb-1" for="inputPhone">Phone number</label>
                <input class="form-control" id="inputPhone" type="tel"
                  placeholder="Enter your phone number" value="@Model.PhoneNumber" readonly>
              </div>
            }
            <div style="display: flex; flex-direction: row;" class="justify-content-between">
              <div>
                <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#followersModal">Followers</button>
                <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#followedUsersModal">Followings</button>
              </div>
              <div>
                <a type="button" class="btn btn-warning" asp-area="" asp-controller="User" asp-action="UserMovies" asp-route-userId="@Model.Id">Movies</a>
                <a type="button" class="btn btn-warning" asp-area="" asp-controller="User" asp-action="WatchList" asp-route-userId="@Model.Id">Watchlist</a>
              </div>
            </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="followersModal" role="dialog">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Followers</h4>
            </div>
              <div class="modal-body">
                <div class="row">
                    <div class="col">
                        @if(followers.Any()) {
                          @foreach (var user in followers)
                          {
                            <div class="d-flex flex-start">
                              @if (string.IsNullOrWhiteSpace(user.ProfilePicture))
                              {
                                  <img class="rounded-circle shadow-1-strong me-3"
                                      src="~/ProfilePictures/DefaultProfilePicture.png" alt="avatar" width="25" height="25">
                              }   
                              else
                              {
                                  <img class="rounded-circle shadow-1-strong me-3" src="@user.ProfilePicture"
                                      alt="avatar" width="25" height="25">
                              }
                              <a class="link-warning" asp-area="" asp-controller="User" asp-action="Profile"
                                                    asp-route-id="@user.Id">@user.UserName</a>
                            </div>
                          }
                        }
                        else {
                          <h5 class="title">There are no followers</h5>
                        }
                        
                    </div>
                </div>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </div>
        </div>
    </div>
</div>

<div class="modal fade" id="followedUsersModal" role="dialog">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Followed Users</h4>
            </div>
              <div class="modal-body">
                <div class="row">
                    <div class="col">
                        @if(followedUsers.Any()) {
                          @foreach (var user in followedUsers)
                          {
                            <div class="d-flex flex-start">
                              @if (string.IsNullOrWhiteSpace(user.ProfilePicture))
                              {
                                  <img class="rounded-circle shadow-1-strong me-3"
                                      src="~/ProfilePictures/DefaultProfilePicture.png" alt="avatar" width="25" height="25">
                              }   
                              else
                              {
                                  <img class="rounded-circle shadow-1-strong me-3" src="@user.ProfilePicture"
                                      alt="avatar" width="25" height="25">
                              }
                              <a class="link-warning" asp-area="" asp-controller="User" asp-action="Profile"
                                                    asp-route-id="@user.Id">@user.UserName</a>
                            </div>
                          }
                        }
                        else {
                          <h5 class="title">There are no followed users</h5>
                        }
                    </div>
                </div>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </div>
        </div>
    </div>
</div>