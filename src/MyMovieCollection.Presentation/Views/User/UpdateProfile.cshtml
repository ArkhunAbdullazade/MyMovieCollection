@model User

@{
  ViewData["Title"] = Model.UserName;

  string UserName = string.Empty;
  string Email = string.Empty;
  string PhoneNumber = string.Empty;
}

<h1>@ViewData["Title"]</h1>

<style>
  .img-account-profile {
    height: 10rem;
  }

  .rounded-circle {
    border-radius: 50% !important;
  }

  .card {
    box-shadow: 0 0.15rem 1.75rem 0 rgb(33 40 50 / 15%);
  }

  .card .card-header {
    font-weight: 500;
  }

  .card-header:first-child {
    border-radius: 0.35rem 0.35rem 0 0;
  }

  .card-header {
    padding: 1rem 1.35rem;
    margin-bottom: 0;
    background-color: rgba(33, 40, 50, 0.03);
    border-bottom: 1px solid rgba(33, 40, 50, 0.125);
  }
</style>

<div class="container-xl px-4 mt-4">
  <hr class="mt-0 mb-4">
  <div class="row">
    <div class="col-xl-4">
      <div class="card mb-4 mb-xl-0 bg-dark">
        <div class="card-header">Profile Picture</div>
        <div class="card-body text-center">
          @if (string.IsNullOrWhiteSpace(Model.ProfilePicture))
          {
            <img class="img-account-profile rounded-circle mb-2" src="~/ProfilePictures/DefaultProfilePicture.png" alt="">
          }
          else
          {
            <img class="img-account-profile rounded-circle mb-2" src="@Model.ProfilePicture" alt="">
          }
        </div>
        <form class="text-center mb-3" enctype="multipart/form-data" accept="image/*" asp-action="UploadProfilePicture"
          asp-controller="User" method="post">
          <input class="form-control mb-3" type="file" name="file" id="file">
          <button class="btn btn-warning" type="file" name="file" id="file">Upload</button>
        </form>
      </div>
    </div>
    <div class="col-xl-8">
      <div class="card mb-4 bg-dark">
        <div class="card-header">Account Details</div>
        <div class="card-body">
          <form id="user-update-form">
            <div class="text-danger" asp-validation-summary="All"></div>

            <div class="mb-3">
              <label class="small mb-1" for="inputUsername">Username</label>
              <input asp-for="@UserName" class="form-control" id="inputUsername" type="text"
                placeholder="Enter your username" value="@Model.UserName">
            </div>
            <div class="mb-3">
              <label class="small mb-1" for="inputEmailAddress">Email address</label>
              <input asp-for="@Email" class="form-control" id="inputEmailAddress" type="email"
                placeholder="Enter your email address" value="@Model.Email">
            </div>
            <div class="mb-3">
              <label class="small mb-1" for="inputPhone">Phone number</label>
              <input asp-for="@PhoneNumber" class="form-control" id="inputPhone" type="tel"
                placeholder="Enter your phone number" value="@Model.PhoneNumber">
            </div>
            <button class="btn btn-warning justify-content-center" type="submit" onclick="updateUser('@Model.Id')">Save
              changes</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  async function updateUser(id) {
    event.preventDefault();
    const form = document.getElementById('user-update-form');
    const formData = new FormData(form);
    let jsonData = {};
    for (let [key, value] of formData.entries()) {
      jsonData[key] = value;
    }

    await fetch('/User/Update/', {
      method: "PUT",
      body: JSON.stringify(jsonData),
      headers: {
        "Content-Type": "application/json"
      }
    })
      .then(data => {
        window.location.href = `/User/Profile?id=${id}`;
      });
  }
</script>